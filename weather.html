<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Dashboard</title>
  <link rel="stylesheet" href="./weather.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <style>
    /* Controls styling */
    .controls {
      margin: 20px auto;
      width: 90%;
      font-family: "Montserrat", sans-serif;
      color: #911911;
      background-color: #efdfbb;
      padding: 15px;
      border-radius: 12px;
      border: 2px solid #911911;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
      text-align: left;
    }

    .controls input {
      padding: 8px;
      border: 2px solid #911911;
      border-radius: 8px;
      margin: 5px 10px 5px 0;
      font-family: "Montserrat", sans-serif;
    }

    .controls button {
      background-color: #911911;
      color: #efdfbb;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      padding: 8px 14px;
      cursor: pointer;
      margin: 5px 5px 5px 0;
      transition: all 0.3s ease;
    }

    .controls button:hover {
      background-color: #b21f1f;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
    }

    /* Weather card styling */
    .weather-card {
      margin: 20px auto;
      width: 90%;
      background: #efdfbb;
      border: 2px solid #911911;
      border-radius: 12px;
      padding: 20px;
      font-family: "Montserrat", sans-serif;
      color: #911911;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
      text-align: left;
    }

    .weather-card h3 {
      margin-bottom: 10px;
      font-weight: 700;
    }

    .current-weather-details {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .current-weather-details img {
      width: 70px;
      height: 70px;
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .forecast-item {
      background: #efdfbb;
      border-left: 5px solid #911911;
      border-top: 5px solid #911911;
      border-right: 2px solid #911911;
      border-bottom: 2px solid #911911;
      border-radius: 8px;
      padding: 10px;
      font-size: 0.9em;
      text-align: left;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .forecast-item img {
      width: 50px;
      height: 50px;
      vertical-align: middle;
      margin-right: 5px;
    }

    /* Spinner */
    .spinner {
      border: 4px solid #efdfbb;
      border-top: 4px solid #911911;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div id="left-heading">SheltR.</div>

  <div class="navbar">
    <a href="./homepage.html">HOME</a>
    <a href="./about.html">ABOUT US</a>
    <a href="./contact.html">CONTACT</a>
    <a href="./settings.html">
      <img src="2nobg.png" alt="Settings" class="settings-icon">
    </a>
  </div>

  <div class="main-bg">
    <div class="heading">Weather Dashboard</div>
    <hr id="section-line">

    <!-- Controls -->
    <div class="controls">
      <input type="text" id="cityInput" placeholder="Enter city name">
      <button onclick="getWeatherByCity()">Get Weather</button>
      <button onclick="getWeatherByLocation()">üìç Detect My Location</button>
    </div>

    <!-- Current Weather -->
    <div id="currentWeather" class="weather-card">
      <h3>Current Weather</h3>
      <div id="currentContent">Enter a city or use location</div>
    </div>

    <!-- Forecast -->
    <div id="forecast" class="weather-card">
      <h3>5-Day Forecast</h3>
      <div id="forecastContent" class="forecast-grid"></div>
    </div>
  </div>

  <script>
    const apiKey = "";

    function showSpinner(elementId) {
      document.getElementById(elementId).innerHTML = `<div class="spinner"></div>`;
    }

    async function getWeatherByCity() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) return alert("Please enter a city name!");
      await fetchWeather(city);
    }

    function getWeatherByLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
          await fetchWeatherByCoords(pos.coords.latitude, pos.coords.longitude);
        }, () => alert("Location access denied. Enter city manually."));
      } else {
        alert("Geolocation not supported by your browser!");
      }
    }

    async function fetchWeather(city) {
      try {
        showSpinner("currentContent");
        showSpinner("forecastContent");

        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${apiKey}`);
        if (!res.ok) throw new Error("City not found");
        const data = await res.json();

        showCurrentWeather(data);
        await fetchForecast(data.coord.lat, data.coord.lon);

      } catch (err) {
        alert("Error fetching weather: " + err.message);
        document.getElementById("currentContent").innerHTML = "Enter a city or use location";
      }
    }

    async function fetchWeatherByCoords(lat, lon) {
      try {
        showSpinner("currentContent");
        showSpinner("forecastContent");

        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`);
        const data = await res.json();

        showCurrentWeather(data);
        await fetchForecast(lat, lon);

      } catch (err) {
        alert("Error fetching weather: " + err.message);
        document.getElementById("currentContent").innerHTML = "Enter a city or use location";
      }
    }

    function showCurrentWeather(data) {
      const icon = data.weather[0].icon;
      document.getElementById("currentContent").innerHTML = `
        <div class="current-weather-details">
          <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${data.weather[0].description}">
          <div>
            <b>${data.name}, ${data.sys.country}</b><br>
            Temp: ${data.main.temp}¬∞C<br>
            Condition: ${data.weather[0].description}<br>
            Humidity: ${data.main.humidity}%<br>
            Wind: ${data.wind.speed} m/s
          </div>
        </div>
      `;
    }

    async function fetchForecast(lat, lon) {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`);
      const data = await res.json();

      const forecastDiv = document.getElementById("forecastContent");
      forecastDiv.innerHTML = "";

      const daily = {};
      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!daily[date] && item.dt_txt.includes("12:00:00")) daily[date] = item;
      });

      Object.keys(daily).slice(0, 5).forEach(date => {
        const day = new Date(date).toDateString();
        const item = daily[date];
        const icon = item.weather[0].icon;

        const card = document.createElement("div");
        card.className = "forecast-item";
        card.innerHTML = `
          <b>${day}</b><br>
          <img src="https://openweathermap.org/img/wn/${icon}.png" alt="${item.weather[0].description}">
          ${item.main.temp}¬∞C<br>
          ${item.weather[0].description}<br>
          ${item.main.humidity}% humidity
        `;
        forecastDiv.appendChild(card);
      });
    }

    // Auto-load on page load
    window.onload = () => {
      getWeatherByLocation();
    }
  </script>
</body>

</html>
